<!DOCTYPE html><html lang="en"><head>
  <title>A Developer's Notebook - Leaving Vancouver</title>

  <meta charset="utf-8">
  <meta name="description" content="A programmer's blog with posts about Ruby, web development, algorithms and data structure.">
  <meta name="author" content="Leonardo Brito">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Nanoc 4.11.16">
  <meta property="og:type" content="website">
  
  <meta property="og:url" content="https://lbrito1.github.io/blog/2024/10/leaving-vancouver.html">
  <meta property="twitter:url" content="https://lbrito1.github.io/blog/2024/10/leaving-vancouver.html">
  
  
  <meta name="image" property="og:image" content="https://lbrito1.github.io/blog/blog/assets/images/2024/vancouver.jpg">
  <meta name="twitter:image" content="https://lbrito1.github.io/blog/blog/assets/images/2024/vancouver.jpg">
  
  
  <meta name="title" property="og:title" content="Leaving Vancouver">
  <meta name="twitter:title" content="Leaving Vancouver">
  
  

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for lbrito.github.io/blog" href="../../feed.xml">
  <link rel="stylesheet" href="../../assets/pure-min.css">
  <link rel="stylesheet" href="../../assets/stylesheet.css">
  <link rel="stylesheet" href="../../assets/highlight.css">

  <script src="../../assets/yall.min.js"></script>
</head>
<body>
  <div id="layout">
    <div class="content">
      <div class="header">
        <h1>
          <a href="../../">A Developer's Notebook</a>
        </h1>
        <nav class="pure-g">
          <div class="pure-u-3-4 links">
            <!-- <a href="/index.html">Home</a> &middot; -->
            <a href="../../tags.html">Tags</a> ¬∑
            <a href="../../years.html">Years</a> ¬∑
            <a href="../../about.html">About</a> ¬∑
            <a href="../../books.html">üìö</a> ¬∑
            <a class="carnaval" href="https://buttondown.email/lbrito">Newsletter!</a>
          </div>

          <div class="pure-u-1-4">
            <div class="contact">
              <span>
                <a class="links-icon" href="https://github.com/lbrito1" download="">
                  <img src="../../assets/icons/github.svg" alt="Github icon">
                </a>
              </span>
              <span>
                <a class="links-icon" href="https://www.linkedin.com/in/leonardo-mendes-brito/">
                  <img src="../../assets/icons/linkedin.svg" alt="LinkedIn icon">
                </a>
              </span>
              <span>
                <a class="links-icon" href="https://lbrito1.github.io/blog/feed.xml">
                  <img src="../../assets/icons/rss.svg" alt="RSS icon">
                </a>
              </span>
            </div>
          </div>
        </nav>

      </div>
      
  <div class="post-show">
    <h2>Leaving Vancouver</h2>

    

    <aside>Posted Oct 22, 2024</aside>
    <aside>Tagged: 
      <a class="" href="../../tags/misc">misc</a>
      
    </aside>
    <article class="text">
      <div class="image-box stretch">
  <div>
    <a href="leaving-vancouver.html">
      <img class="lazy" data-src="/blog/assets/images/2024/vancouver.jpg" alt="Dreary view of a foggy city through a highrise balcony.">
      <noscript>
        <img src="../../blog/assets/images/2024/vancouver.jpg" alt="Alternative text to describe image.">
      </noscript>
    </a>
  </div>
  
    <div class="image-caption">So dreary I didn't need to compact this image.</div>
  
</div>

<p>After about two years living in metro Vancouver, I decided to leave. I‚Äôm in a smaller city in the Fraser Valley, and it has been great!</p>

<p>My first time in Vancouver was for an interview at Amazon in 2019. I stayed at a hotel near the downtown office for a couple of nights, which was less time than I spent in the 6 different airplanes and a similar number of airports to get there from Brazil. Then the pandemic happened. After almost two years waiting for the visa, I finally moved to Vancouver in late 2021.</p>

<!-- more -->

<p>My home town of Recife has a tongue-in-cheek tradition of boastfulness, typically claiming ridiculous titles like having the world‚Äôs longest street or largest apartment complex. In Vancouver I kind of felt the flipside to that good-natured humour: people seem serious when claiming that this place is the best at this or that.</p>

<p>At some level, the level of braggadocio found in Vancouver must be part of the all-encompassing real estate industry (which as of 2023 represents 17.75% of BC‚Äôs GDP), which obviously benefits from selling the region as the best at everything. But my perception was that everyday people more or less buy into these views, not batting an eye at claims to having ‚Äúthe best‚Äù of something - food, transport or housing.</p>

<p>On housing - I lived for a few months in a high-rise apartment which had around 350 units and only 3 elevators - 15 minute waits for an elevator ride were commonplace (for comparison, my old apartment building in Brazil had 64 units and 2 elevators). Building-wide fire alarms went off once a month for ridiculous things like the ground-level retail burning a tortilla. None of this was seen as abnormal or even a bother - people seemed OK with it.</p>

<p>The city has a nice natural framing, with ocean and mountains, but that‚Äôs really it. The urban environment itself is underwhelming. It looks like any other large North American city, courtesy of having the same draconian zoning laws as basically everywhere else in Canada and the US for the last century or so. The province is going in the right direction by loosening restrictive zoning, but the improvements will take a long time to be noticeable. But my personal impression of Vancouver will remain the blue-gray blandness of the header image, while other places have so much more to offer.</p>

<div class="image-box stretch">
  <div>
    <a href="../../blog/assets/images/2024/river-sm.jpg" target="_blank">
      <img class="lazy " data-src="/blog/assets/images/2024/river-sm.jpg" alt="Photo of a river with many stones and a large log.">
      <noscript>
        <img src="../../blog/assets/images/2024/river-sm.jpg" alt="Photo of a river with many stones and a large log.">
      </noscript>
    </a>
  </div>
  
    <div class="image-caption">That's more like it!</div>
  
</div>


    </article>
    <div class="post-footer">
      <a href="../../index.html">Back</a>
    </div>
  </div>

      <div class="footer">

        <div>
          <form action="https://buttondown.email/api/emails/embed-subscribe/lbrito" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lbrito', 'popupwindow')" class="embeddable-buttondown-form">
          <label for="bd-email">Did you enjoy this post? Join the newsletter!</label>
          <div>
            <input type="email" name="email" id="bd-email">
            <input type="submit" value="Subscribe">
            <p>
              <a href="https://buttondown.email" target="_blank">Powered by Buttondown.</a>
            </p>
          </div></form>
        
      </div>
      <div class="final">
        2024 Leonardo Brito ¬∑ Powered by <a href="https://github.com/lbrito1/sane-blog-builder">sane blog builder</a>
      </div>
    </div>
  </div>

</div>


<script>
  document.addEventListener("DOMContentLoaded", yall);
  fetch("https://precious-wise-dogfish.ngrok-free.app/damn_fine_coffee", { headers: { "X-Referer": window.location.href }, referrerPolicy: "unsafe-url" });
</script>


</body></html>described in <a href="https://mbobin.me/ruby/2017/02/25/ruby-on-rails-on-android.html">this neat tutorial</a>. Just <a href="https://devcenter.heroku.com/articles/ruby-default-web-server#why-not-webrick">don‚Äôt use WEBRick</a>, the default Rails web server in development ‚Äì it is single-process, single-threaded and thus not suitable for production environments (it is fine for small experiments though).</p>

<p><strong>Run this on Android:</strong></p>
<div class="highlight"><pre><code class="language-bash">pkg <span class="nb">install </span>ruby
gem <span class="nb">install </span>sinatra puma</code></pre></div>

<h2 id="install-nginx">Install nginx</h2>

<p>nginx is a web server, reverse-proxy and load balancer. Although most useful in multi-server setups where it is used to distribute requests among different instances, nginx is also a good idea in our setup because of the embedded DDoS protection and static file serving that it provides.</p>

<p><strong>Run this on Android:</strong></p>
<div class="highlight"><pre><code class="language-bash">pkg <span class="nb">install </span>nginx</code></pre></div>

<p>Now the slightly tricky part is configuring nginx to work with Puma. <a href="https://gist.github.com/ctalkington/4448153">This gist</a> is a pretty good start ‚Äì copy &amp; paste <code>nginx.conf</code> and change <code>appdir</code> to your webapp‚Äôs root dir. In my case, for example, that would be <code>/data/data/com.termux/files/home/android-sinatra</code>.</p>

<h2 id="set-up-port-forwarding">Set up port forwarding</h2>

<p>You probably want your web server to be accessible through the internet, so you‚Äôll have to set up port forwarding in your router to redirect incoming requests to your public IP address to your brand new Android web server.</p>

<p>How exactly to do this varies depending on your router. <a href="https://www.noip.com/support/knowledgebase/general-port-forwarding-guide/">Here‚Äôs</a> a pretty good tutorial to get you started.</p>

<h2 id="configure-a-dynamic-dns">Configure a dynamic dns</h2>

<p>Most people have dynamic public IP addresses. In these cases it is useful to set up a dynamic dns (DDNS) service, which provides you with a static domain name that redirects automatically to whatever your public IP address is at that moment.</p>

<p>There are few free services that provide DDNS nowadays; I‚Äôm using <a href="https://www.noip.com/">no-ip</a> and it has been okay so far. You do have to ‚Äúrenew‚Äù your domain every month though.</p>

<p>After setting up a DDNS, you‚Äôll have to configure your router as well so that it periodically notifies the DDNS service with your current IP address. Again, how exactly to do this depends on your router model.</p>

<h2 id="hello-world">Hello world!</h2>

<div class="image-box stretch">
  <div>
    <a href="../../blog/assets/images/2020/android-web-server.jpg" target="_blank">
      <img class="lazy " data-src="/blog/assets/images/2020/android-web-server.jpg" alt="Puma and nginx running on a Motorola G5.">
      <noscript>
        <img src="../../blog/assets/images/2020/android-web-server.jpg" alt="Puma and nginx running on a Motorola G5.">
      </noscript>
    </a>
  </div>
  
    <div class="image-caption">Puma and nginx running on a Motorola G5.</div>
  
</div>

<h2 id="under-siege">Under siege</h2>

<p>You can simulate real-world usage through <a href="https://www.joedog.org/siege-home/"><code>siege</code></a>, a http load testing software. Here‚Äôs a screenshot of <code>siege</code> running on my setup with 3 concurrent users (real tests would use bigger numbers):</p>

<div class="image-box stretch">
  <div>
    <a href="../../blog/assets/images/2020/siege.jpg" target="_blank">
      <img class="lazy " data-src="/blog/assets/images/2020/siege.jpg" alt="Screenshot of siege running on a terminal.">
      <noscript>
        <img src="../../blog/assets/images/2020/siege.jpg" alt="Screenshot of siege running on a terminal.">
      </noscript>
    </a>
  </div>
  
    <div class="image-caption">siege running in the foreground; nginx logs and top on remote (android) running in the background terminals.</div>
  
</div>

<p>The numbers in that screenshot don‚Äôt matter much because our webapp was serving a simple 100-char response with a timestamp, but it is enough to at least know that the server can handle a few concurrent users.</p>

<h2 id="epilogue-safety">Epilogue: safety</h2>

<p>If you‚Äôve watched <a href="https://en.wikipedia.org/wiki/Mr._Robot">Mr Robot</a>, you know that the internet can be a dangerous place. That is a lot more true if you have a web server open to the internet.</p>

<p>Within a few hours of opening up the server, it was already being crawled by all sorts of things. Most are innocuous indexing robots, but some are definitively not so nice, like these two requests:</p>

<div class="image-box stretch">
  <div>
    <a href="../../blog/assets/images/2020/scanners.jpg" target="_blank">
      <img class="lazy " data-src="/blog/assets/images/2020/scanners.jpg" alt="nginx logs showing port scanning attacks.">
      <noscript>
        <img src="../../blog/assets/images/2020/scanners.jpg" alt="nginx logs showing port scanning attacks.">
      </noscript>
    </a>
  </div>
  
    <div class="image-caption">Most of those requests seem fine, but the two in red are probably some kind of attack.</div>
  
</div>

<p>So the headline here is: keep all software updated, keep an eye on access logs and maybe go through nginx safety guides such as <a href="https://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html">this</a> and <a href="https://geekflare.com/nginx-webserver-security-hardening-guide/">this</a>.</p>

    </article>
    <div class="post-footer">
      <a href="../../index.html">Back</a>
    </div>
  </div>

      <div class="footer">

        <div>
          <form action="https://buttondown.email/api/emails/embed-subscribe/lbrito" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lbrito', 'popupwindow')" class="embeddable-buttondown-form">
          <label for="bd-email">Did you enjoy this post? Join the newsletter!</label>
          <div>
            <input type="email" name="email" id="bd-email">
            <input type="submit" value="Subscribe">
            <p>
              <a href="https://buttondown.email" target="_blank">Powered by Buttondown.</a>
            </p>
          </div></form>
        
      </div>
      <div class="final">
        2024 Leonardo Brito ¬∑ Powered by <a href="https://github.com/lbrito1/sane-blog-builder">sane blog builder</a>
      </div>
    </div>
  </div>

</div>


<script>
  document.addEventListener("DOMContentLoaded", yall);
  fetch("https://precious-wise-dogfish.ngrok-free.app/damn_fine_coffee", { headers: { "X-Referer": window.location.href }, referrerPolicy: "unsafe-url" });
</script>


</body></html>