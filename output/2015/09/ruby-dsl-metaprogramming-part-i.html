<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="Description" content="A programmer's blog with posts about Ruby, web development, algorithms and data structure.">
    <meta name="author" content="Leonardo Brito">

    <title>A Developer's Notebook - My attempt at creating more</title>

    <link rel="alternate" type="application/rss+xml" title="RSS Feed for lbrito.github.io/blog" href="../../feed.xml">
    <link rel="stylesheet" href="../../assets/pure-min.css">
    <link rel="stylesheet" href="../../assets/stylesheet.css">
    <link rel="stylesheet" href="../../assets/highlight.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="Nanoc 4.11.16">

    
      <meta name="image" property="og:image" content="/blog/assets/images/fan_page_screenshot.png">
    

    <script src="../../assets/yall.min.js"></script>
  </head>
  <body>
    <div id="layout">
      <div class="content">
        <div class="header">
          <h1>
            <a href="../../">A Developer's Notebook</a>
          </h1>
          <nav class="pure-g">
            <div class="pure-u-2-3 links">
              <a href="../../index.html">Home</a> ·
              <a href="../../tags.html">Tags</a> ·
              <a href="../../years.html">Years</a> ·
              <a href="../../about.html">About</a>
            </div>

            <div class="pure-u-1-3">
              <div class="contact">
                <span>
                  <a class="links-icon" href="https://github.com/lbrito1" download="">
                    <img src="../../assets/icons/github.svg" alt="Github icon">
                    </a>
                </span>
                <span>
                  <a class="links-icon" href="https://www.linkedin.com/in/leonardo-mendes-brito/">
                  <img src="../../assets/icons/linkedin.svg" alt="LinkedIn icon">
                  </a>
                </span>
                <span>
                  <a class="links-icon" href="https://lbrito1.github.io/blog/feed.xml">
                  <img src="../../assets/icons/rss.svg" alt="RSS icon">
                  </a>
                </span>
              </div>
            </div>
          </nav>

        </div>
        
  <div class="post-show">
    <h2>My attempt at creating more</h2>
    <article class="text">
      <p>I began blogging in the now prehistoric late 2000s.</p>

<p>I’ve done a few blogs about different subjects (computer science, algorithms, web development, short stories and political ramblings). I’ve had blogs on Blogspot, Wordpress and, more recently, Medium.</p>

<p>Those platforms were (or are, I suppose) an easy way to spew your ideas over the Internet while also being nice and comfy for other people to actually read (this last point is important for the CSS-challenged such as yours truly). In other words, those services Got Shit Done™.</p>

<!-- more -->

<p>Alas, as I opened my eyes to the wonders of web development I started noticing a few things. First, Wordpress is written in PHP, which is gross (just kidding). Second, you don’t really control much: you can pick themes or whatever, but you won’t have the full control you’d have by creating a website from scratch or nearly scratch. Third, and maybe a corollary to the previous point, that stuff is <em>bloated</em>. There’s approximately 3 terabytes of mostly useless JavaScript, ads and all kind of crap I don’t care about.</p>

<p>But most importantly, I understood the hidden costs of most “free” web services. You don’t really own anything. You provide content, and Wordpress or Google or whoever package that content into a neat bundle and servce it to your audience together with whatever else (<em>cough, trackers</em>) they see fit.</p>

<p>That’s one of the reasons that pushed me towards a less-walled-garden approach towards blogging. But there’s a nother reason as well.</p>

<p>As <a href="https://code.divshot.com/geo-bootstrap/">many others</a>, I have fond memories of the late-90s/early-2000s Web 1.0 Internet. There is something warm and fuzzy about those beautifully terrible Geocities pages. They pierced the eyes of the viewer but were wondrous in a way. As I said, I’m not alone: Web 1.0 nostalgia is definitively <a href="https://gizmodo.com/the-great-web-1-0-revival-1651487835">on the rise</a>.</p>

<p>But why? What is not to like in our world of beautiful walled gardens? Surely it is better than those gross-looking Web 1.0 fan sites about some crappy GameBoy game, right? …Right?</p>

<div class="image-box stretch">
  <div>
    <a href="../../blog/assets/images/fan_page_screenshot.png" target="_blank">
      <img class="lazy" data-src="/blog/assets/images/fan_page_screenshot.png" alt="View of an old website about Pokemon">
      <noscript>
        <img src="../../blog/assets/images/fan_page_screenshot.png" alt="Alternative text to describe image.">
      </noscript>
    </a>
  </div>
  
    <div class="image-caption">We're soooo cooler than this in 2019.</div>
  
</div>

<p><em>Wrong.</em></p>

<p>Well, in many ways the Internet has of course improved over time. It has useful things like search engines and Wikipedia, and convenient subscription-based entertainment like Netflix. It has a whole bunch of nice stuff I could spend hours blabbering about.</p>

<p>But it also has a lot of problems. At this point there are surely many PhD theses about most of them, so I won’t bother. I’m just going to recommend one <a href="https://www.nytimes.com/2019/08/11/world/americas/youtube-brazil.html">New York Times article</a> that explains how YouTube indirectly helped elect a buffoon that <a href="https://extra.globo.com/noticias/brasil/bolsonaro-faz-piada-com-oriental-tudo-pequenininho-ai-veja-video-rv1-1-23668287.html">makes high school-tier penis jokes</a> as president of Brazil.</p>

<p>Now, the specific problem with today’s Internet that I feel is most relevant regarding blogging is how we’re gravitating towards all these “free” services all the time. Medium, for instance, is so <em>nice looking</em> that one doesn’t even think of perhaps using something else. But what happens when <em>everyone</em> uses Medium? First: all the blogs look exactly the same, which is lame. Second, Medium gets all that content and traffic for itself, for free.</p>

<p>Of course, not everyone is skilled enough to build a personal blog from scratch. I am just barely able, as you can see from my lackluster front-end skills (I promise you I’m good on back-end things). So I’m definitively not dismissing the inclusiveness that services like Medium offer.</p>

<p>But as I searched for a way out of the walled gardens and fiddled with <a href="https://jekyllrb.com/">Jekyll</a> for a while, I figured I might as well just <a href="https://tjcx.me/posts/consumption-distraction/">build something to call my own</a>.</p>

<h2 id="so-i-built-this">So I built this.</h2>

<p>The goals were to create the simplest possible blogging system with as little fluff as possible. It should meet what I defined as basic blogging needs: list posts, show post, use tags, use images etc. And also not have 3 terabytes of JavaScript split in 90 requests just to show a fancy menu button.</p>

<p>So I started messing with Nanoc, an excellent Ruby library for static page generation, and came up with <a href="https://github.com/lbrito1/sane-blog-builder">this bad boy</a>.</p>

<p>I won’t pretend these ideas are new. They aren’t! I feel there’s been an increasing amount of <a href="https://code.divshot.com/geo-bootstrap/">Web 1.0 nostalgia</a> going on, and a big part of that is probably fueled by <a href="https://tjcx.me/posts/consumption-distraction/">similar sentiments</a> as those I described. The <a href="https://thebestmotherfucking.website/">longing for simplicity</a> in a world of trillions of new JS frameworks is also quite widespread these days.</p>

<p>This small project is nothing special. There are <a href="https://github.com/remko/blog-skeleton">much better projects</a> <a href="https://clarkdave.net/2012/02/building-a-static-blog-with-nanoc/">available for free</a> on the Internet done by people that actually know what they’re doing with a CSS file. This here is just a tiny vase with some ugly flowers – it would be ridiculous to compare it to the beautiful walled gardens of Medium or Wordpress. But, ugly as they are, they’re <strong>mine</strong>!</p>

    </article>
    <aside>Posted Aug 29, 2019</aside>
    <div class="post-footer">
      <a href="../../index.html">Back</a>
    </div>
  </div>

        <div class="footer">
          2021 Leonardo Brito · Powered by <a href="https://github.com/lbrito1/sane-blog-builder">sane blog builder</a>
        </div>
      </div>

    </div>
  

  <script>
    document.addEventListener("DOMContentLoaded", yall);
    fetch("https://android-analytics.duckdns.org/damn_fine_coffee");
  </script>


</body></html>>$ </span>ruby lero.rb
Read dictionary with: noun <span class="o">[</span><span class="s2">"dog"</span>, <span class="s2">"bus"</span><span class="o">]</span>
Read dictionary with: verb <span class="o">[</span><span class="s2">"barked"</span>, <span class="s2">"parked"</span><span class="o">]</span>
Read dictionary with: preposition <span class="o">[</span><span class="s2">"at"</span><span class="o">]</span>
Read rule with: phrase <span class="o">[</span><span class="s2">"noun"</span>, <span class="s2">"verb"</span>, <span class="s2">"preposition"</span>, <span class="s2">"noun"</span><span class="o">]</span>
Read codex with: <span class="o">[</span><span class="s2">"phrase"</span><span class="o">]</span>
Codex is applying phrase
Applying rule with key: noun
Fetching noun from dictionary
Applying rule with key: verb
Fetching verb from dictionary
Applying rule with key: preposition
Fetching preposition from dictionary
Applying rule with key: noun
Fetching noun from dictionary
Final result:
<span class="o">=======</span>
bus barked at dog
<span class="o">=======</span></code></pre></div>

<p>Nonsensical, but still pretty cool.</p>

<p>Let’s take a look at our DSL script for a while. It works fine, but isn’t very <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>. Wouldn’t it be nice to add some structure and be less repetitious? Let’s try to define Dictionary and Rule entries as functions:</p>

<div class="highlight"><pre><code class="language-bash">dictionary
  noun <span class="s1">'dog'</span>, <span class="s1">'bus'</span>
  verb <span class="s1">'barked'</span>, <span class="s1">'parked'</span>
  preposition <span class="s1">'at'</span>

rule
  phrase <span class="s1">'noun'</span>, <span class="s1">'verb'</span>, <span class="s1">'preposition'</span>, <span class="s1">'noun'</span>

codex <span class="s1">'phrase'</span></code></pre></div>

<p>Much better. But what if we wanted different nouns to belong in different dictionary entries, say, <code>animal_nouns</code> and <code>vehicle_nouns</code>? Are we supposed to define every possible word class as a separate method? That’s not very DRY!</p>

<p>Here’s where things start getting beautiful: Ruby has a method called <code>method_missing</code> (good material <a href="http://rubylearning.com/satishtalim/ruby_method_missing.html">here</a> and <a href="http://www.alef1.org/ruby/method_missing/">here</a>), which by default raises a NoMethodError, but can be overridden to do some cool stuff. Let’s leverage the power of <code>method_missing</code>:</p>

<div class="highlight"><pre><code class="language-ruby"><span class="o">...</span>

<span class="k">def</span> <span class="nf">dictionary</span>
  <span class="vi">@state</span> <span class="o">=</span> <span class="ss">:dictionary</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">rule</span>
  <span class="vi">@state</span> <span class="o">=</span> <span class="ss">:rule</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">codex</span> <span class="o">*</span><span class="n">rulenames</span>
  <span class="nb">puts</span> <span class="s2">"Read codex with: </span><span class="si">#{</span><span class="n">rulenames</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">"</span>
  <span class="vi">@grammar</span><span class="p">.</span><span class="nf">codex</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="no">Codex</span><span class="p">.</span><span class="nf">new</span> <span class="n">rulenames</span><span class="p">)</span>
<span class="k">end</span>

<span class="vi">@state</span> <span class="o">=</span> <span class="ss">:idle</span>

<span class="k">def</span> <span class="nf">method_missing</span> <span class="nb">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
  <span class="k">case</span> <span class="vi">@state</span>
  <span class="k">when</span> <span class="ss">:dictionary</span>
    <span class="nb">puts</span> <span class="s2">"Read dictionary with: </span><span class="si">#{</span><span class="nb">method</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">args</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">"</span>
    <span class="no">Dictionary</span><span class="p">.</span><span class="nf">instance</span><span class="p">.</span><span class="nf">add</span> <span class="nb">method</span><span class="p">.</span><span class="nf">to_s</span><span class="p">,</span> <span class="n">args</span>
  <span class="k">when</span> <span class="ss">:rule</span>
    <span class="nb">puts</span> <span class="s2">"Read rule with: </span><span class="si">#{</span><span class="nb">method</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">args</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">"</span>
    <span class="vi">@grammar</span><span class="p">.</span><span class="nf">rules</span><span class="p">[</span><span class="nb">method</span><span class="p">.</span><span class="nf">to_s</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="no">Rule</span><span class="p">.</span><span class="nf">new</span> <span class="n">args</span><span class="p">)</span>
  <span class="k">when</span> <span class="ss">:idle</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"Boom! Something went wrong. I don't know what to do with </span><span class="si">#{</span><span class="vi">@state</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">."</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Now <code>method_missing</code> captures undefined methods and the appropriate entries are created depending on which function was last called (i.e. <code>dictionary</code> or <code>rule</code>). This relieves us from defining methods for <code>noun</code>, <code>verb</code>, etc. Pretty great, but we can do better. We still have some very trivial-looking method definitions in our DSL:</p>

<div class="highlight"><pre><code class="language-ruby"><span class="k">def</span> <span class="nf">dictionary</span>
  <span class="vi">@state</span> <span class="o">=</span> <span class="ss">:dictionary</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">rule</span>
  <span class="vi">@state</span> <span class="o">=</span> <span class="ss">:rule</span>
<span class="k">end</span></code></pre></div>

<p>What if we decide later on to add some new functionality to our DSL that works analogously to rules and dictionaries? We’d have to write more method definitions that just&nbsp;set&nbsp;the&nbsp;@<code>state</code> variable. Once more, Ruby offers us some DRYing magic: we can dynamically define methods just as if they were objects.</p>

<div class="highlight"><pre><code class="language-ruby"><span class="o">...</span>

<span class="sx">%w'rule dictionary'</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">keyword</span><span class="o">|</span>
  <span class="n">define_method</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@state</span> <span class="o">=</span> <span class="n">keyword</span><span class="p">.</span><span class="nf">to_sym</span> <span class="p">}</span>
<span class="k">end</span></code></pre></div>

<p>The resulting methods are identical to the ones we defined statically with <code>def</code>. This may not seem like a great advantage over our previous code, but imagine if there were not 2 but 20 similar methods which could be dynamically defined - quite an improvement! There’s still room for improvement using <code>define_method</code>. Instead of storing strings in a Dictionary, we might as well define a function that chooses an entry at random. Here’s the Dictionary class:</p>

<div class="highlight"><pre><code class="language-ruby"><span class="nb">require</span> <span class="s1">'singleton'</span>

<span class="k">class</span> <span class="nc">Dictionary</span>
  <span class="kp">include</span> <span class="no">Singleton</span>


  <span class="k">def</span> <span class="nf">add</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span>
    <span class="vi">@dicts</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="vi">@dicts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">fetch</span> <span class="n">key</span>
    <span class="nb">puts</span> <span class="s2">"Fetching </span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2"> from dictionary"</span>
    <span class="vi">@dicts</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nf">sample</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre></div>

<p>We can eliminate the need for that entire class by defining methods dynamically using a single line of code:</p>

<div class="highlight"><pre><code class="language-ruby"><span class="o">...</span>

<span class="k">def</span> <span class="nf">method_missing</span> <span class="nb">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
  <span class="k">case</span> <span class="vi">@state</span>
  <span class="k">when</span> <span class="ss">:dictionary</span>
    <span class="nb">puts</span> <span class="s2">"Read dictionary with: </span><span class="si">#{</span><span class="nb">method</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">args</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">define_method</span><span class="p">(</span><span class="nb">method</span><span class="p">)</span> <span class="p">{</span> <span class="n">args</span><span class="p">.</span><span class="nf">sample</span> <span class="p">}</span>

<span class="o">...</span></code></pre></div>

<p>If you’re wondering, <code>sample</code> picks an array element at random.</p>

<p>So that’s that: we successfully used some of Ruby’s core metaprogramming tools, <code>method_missing</code> and <code>define_method</code>, to improve our little program. <a href="https://github.com/lbrito1/ruby_textgen/tree/part-1">Full code</a> is hosted on Github - please not that it may differ slightly from what is presented here for didactic reasons.</p>

<p>In the next installment we’ll continue to improve our DSL using more interesting Ruby features.</p>

    </article>
    <aside>Posted Sep 11, 2015</aside>
    <div class="post-footer">
      <a href="../../index.html">Back</a>
    </div>
  </div>

        <div class="footer">
          2021 Leonardo Brito · Powered by <a href="https://github.com/lbrito1/sane-blog-builder">sane blog builder</a>
        </div>
      </div>

    </div>
  

  <script>
    document.addEventListener("DOMContentLoaded", yall);
    fetch("https://android-analytics.duckdns.org/damn_fine_coffee");
  </script>


</body></html>